function u = qp_soln(q,r1,r2,r3,r4, xd)
    m = 12; g = [0;0;-9.81];
    p_d = xd(1:3);
%     rpy = [0,0,0];
    rpy = xd(4:6)';
    Ib = diag([0.0168, 0.0565, 0.064]);
    p = q(1:3);
    R = reshape(q(4:12),[3,3]);
    dp = q(13:15);
    wb = q(16:18);
    mu = 0.5;
    S = diag([2,2,10,1,2,1]);
    alpha = 0.01;
    Kp_p = diag([30,30,400]);
    Kd_p = diag([10,10,50]);
    Kp_R = diag([10,10,10]);
    Kd_R = diag([5,5,5]);
    Rd = eul2rotm(rpy);
    ypr_e = rotm2eul(Rd*R');
    rpy_e = [ypr_e(3);ypr_e(2);ypr_e(1);];
    ddp_d = Kp_p*(p_d - p) + Kd_p*(-dp);
    dw_d = Kp_R*rpy_e + Kd_R*(-wb);
    A = [eye(3), eye(3), eye(3), eye(3);
     Vec2Skewmat(r1),Vec2Skewmat(r2),Vec2Skewmat(r3),Vec2Skewmat(r4)];
    b_d = [m*(ddp_d - g);
     R*(Ib*dw_d + cross(wb, Ib*wb))];
    H = A'*S*A + alpha*eye(12);
    f = -2*b_d'*S*A;
    Aqp_block = [1 0 -mu;
     -1 0 -mu;
     0 1 -mu;
     0 -1 -mu;
     0 0 1;
     0 0 -1];
    Aqp = blkdiag(Aqp_block,Aqp_block,Aqp_block,Aqp_block);
    bqp_block = [0;0;0;0;500;-10];
    bqp = [bqp_block;bqp_block;bqp_block;bqp_block];
%     options = optimoptions('quadprog','Display','off');
    coder.extrinsic('quadprog');
    u = quadprog(H,f,Aqp,bqp,[],[],[],[],[]);
end